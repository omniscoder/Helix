{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://omniscoder.github.io/Helix/snapshot_spec_v1.schema.json",
  "title": "Helix Snapshot Spec v1",
  "description": "Contract for .hxs bundles covering manifest layout, run entries, compare verdicts, and attached assets.",
  "type": "object",
  "required": [
    "snapshot_spec",
    "snapshot_id",
    "created_at",
    "studio_version",
    "cli_version",
    "schema_version",
    "runs",
    "assets"
  ],
  "additionalProperties": false,
  "properties": {
    "snapshot_spec": {
      "type": "string",
      "pattern": "^1\\.0\\.\\d+$"
    },
    "snapshot_id": {
      "type": "string"
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "studio_version": {
      "type": "string"
    },
    "cli_version": {
      "type": "string"
    },
    "schema_version": {
      "type": "string"
    },
    "seed": {
      "type": "integer",
      "minimum": 0
    },
    "compatibility": {
      "$ref": "#/defs/compat"
    },
    "runs": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/defs/runEntry"
      }
    },
    "compare": {
      "type": "array",
      "items": {
        "$ref": "#/defs/compareEntry"
      }
    },
    "reports": {
      "type": "array",
      "items": {
        "$ref": "#/defs/reportEntry"
      }
    },
    "assets": {
      "type": "array",
      "items": {
        "$ref": "#/defs/assetEntry"
      }
    },
    "manifest_sha256": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$"
    }
  },
  "defs": {
    "compat": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "studio": { "type": "string" },
        "cli": { "type": "string" },
        "ogn": { "type": "string" }
      }
    },
    "contentRef": {
      "type": "object",
      "required": ["path", "sha256"],
      "additionalProperties": false,
      "properties": {
        "path": { "type": "string" },
        "sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        },
        "size": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "engine": {
      "type": "object",
      "required": ["name", "version"],
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string" },
        "version": { "type": "string" },
        "build": { "type": "string" }
      }
    },
    "runArtifact": {
      "type": "object",
      "required": ["kind", "path", "sha256"],
      "additionalProperties": false,
      "properties": {
        "kind": { "type": "string" },
        "path": { "type": "string" },
        "sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        },
        "size": { "type": "integer", "minimum": 0 },
        "schema": { "type": "string" }
      }
    },
    "runStatus": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "outcome": {
          "type": "string",
          "enum": ["success", "failed", "partial", "unknown"]
        },
        "duration_ms": {
          "type": "integer",
          "minimum": 0
        },
        "queued_at": { "type": "string", "format": "date-time" },
        "started_at": { "type": "string", "format": "date-time" },
        "finished_at": { "type": "string", "format": "date-time" }
      }
    },
    "runEntry": {
      "type": "object",
      "required": ["id", "kind", "engine", "params", "artifacts"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string" },
        "kind": { "type": "string" },
        "engine": { "$ref": "#/defs/engine" },
        "params": { "$ref": "#/defs/contentRef" },
        "artifacts": {
          "type": "array",
          "items": { "$ref": "#/defs/runArtifact" }
        },
        "status": { "$ref": "#/defs/runStatus" },
        "ogn": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "queue": { "type": "string" },
            "job_id": { "type": "string" },
            "submitted_at": { "type": "string", "format": "date-time" }
          }
        }
      }
    },
    "compareEntry": {
      "type": "object",
      "required": ["id", "left_run", "right_run", "verdict"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string" },
        "left_run": { "type": "string" },
        "right_run": { "type": "string" },
        "verdict": {
          "type": "string",
          "enum": ["improved", "worse", "tradeoff", "inconclusive"]
        },
        "thresholds": { "type": "object" },
        "path": { "type": "string" },
        "sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        }
      }
    },
    "reportEntry": {
      "type": "object",
      "required": ["id", "format", "path", "sha256"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string" },
        "format": { "type": "string", "enum": ["md", "html", "json", "pdf"] },
        "source_run": { "type": "string" },
        "path": { "type": "string" },
        "sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        }
      }
    },
    "assetEntry": {
      "type": "object",
      "required": ["path", "sha256"],
      "additionalProperties": false,
      "properties": {
        "path": { "type": "string" },
        "sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        },
        "kind": { "type": "string" },
        "role": { "type": "string" }
      }
    }
  }
}
